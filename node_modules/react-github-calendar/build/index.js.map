{"version":3,"file":"index.js","sources":["../src/lib.ts","../src/index.tsx"],"sourcesContent":["import type { Activity } from './types'\n\nexport const transformData = (\n  data: Array<Activity>,\n  transformFn?: (data: Array<Activity>) => Array<unknown>,\n): Array<Activity> => {\n  if (typeof transformFn !== 'function') {\n    return data\n  }\n\n  const transformedData = transformFn(data)\n\n  if (!Array.isArray(transformedData)) {\n    throw Error(`transformData() function must return a list of Activity objects.`)\n  }\n\n  for (const d of transformedData) {\n    if (!isRecord(d)) {\n      throw Error(`transformData() must return a list of valid Activity objects.`)\n    }\n\n    if (typeof d.count !== 'number' || d.count < 0) {\n      throw Error(`Required property \"count: number\" missing or invalid. Got: ${d.count as string}`)\n    }\n\n    if (typeof d.date !== 'string' || !/\\d{4}-\\d{2}-\\d{2}/.test(d.date)) {\n      throw Error(\n        `Required property \"date: YYYY-MM-DD\" missing or invalid. Got: ${d.date as string}`,\n      )\n    }\n\n    if (typeof d.level !== 'number' || d.level < 0 || d.level > 4) {\n      throw Error(\n        `Required property \"level: 0 | 1 | 2 | 3 | 4\" missing or invalid: Got: ${d.level as string}.`,\n      )\n    }\n  }\n\n  return transformedData as Array<Activity>\n}\n\nconst isRecord = (o: unknown): o is Record<string, unknown> =>\n  Object.prototype.toString.call(o) === '[object Object]'\n","'use client'\n\nimport { forwardRef, useCallback, useEffect, useState } from 'react'\nimport Calendar, {\n  Skeleton,\n  type Props as ActivityCalendarProps,\n  type ThemeInput,\n} from 'react-activity-calendar'\nimport { transformData } from './lib'\nimport type { Activity, ApiErrorResponse, ApiResponse, Year } from './types'\n\nexport type Props = {\n  username: string\n  errorMessage?: string\n  throwOnError?: boolean\n  transformData?: (data: Array<Activity>) => Array<Activity>\n  transformTotalCount?: boolean\n  year?: Year\n} & Omit<ActivityCalendarProps, 'data'>\n\nasync function fetchCalendarData(username: string, year: Year): Promise<ApiResponse> {\n  const apiUrl = 'https://github-contributions-api.jogruber.de/v4/'\n  const response = await fetch(`${apiUrl}${username}?y=${String(year)}`)\n  const data = (await response.json()) as ApiResponse | ApiErrorResponse\n\n  if (!response.ok) {\n    throw Error(\n      `Fetching GitHub contribution data for \"${username}\" failed: ${(data as ApiErrorResponse).error}`,\n    )\n  }\n\n  return data as ApiResponse\n}\n\nconst GitHubCalendar = forwardRef<HTMLElement, Props>(\n  (\n    {\n      username,\n      year = 'last',\n      labels,\n      transformData: transformFn,\n      transformTotalCount = true,\n      throwOnError = false,\n      errorMessage = `Error â€“ Fetching GitHub contribution data for \"${username}\" failed.`,\n      ...props\n    },\n    ref,\n  ) => {\n    const [data, setData] = useState<ApiResponse | null>(null)\n    const [loading, setLoading] = useState(false)\n    const [error, setError] = useState<Error | null>(null)\n\n    const fetchData = useCallback(() => {\n      setLoading(true)\n      setError(null)\n      fetchCalendarData(username, year)\n        .then(setData)\n        .catch((err: unknown) => {\n          if (err instanceof Error) {\n            setError(err)\n          }\n        })\n        .finally(() => {\n          setLoading(false)\n        })\n    }, [username, year])\n\n    useEffect(fetchData, [fetchData])\n\n    // React error boundaries can't handle asynchronous code, so rethrow.\n    if (error) {\n      if (throwOnError) {\n        throw error\n      } else {\n        return <div>{errorMessage}</div>\n      }\n    }\n\n    if (loading || !data) {\n      return <Skeleton {...props} loading />\n    }\n\n    const theme = props.theme ?? gitHubTheme\n\n    const defaultLabels = {\n      totalCount: `{{count}} contributions in ${year === 'last' ? 'the last year' : '{{year}}'}`,\n    }\n\n    const totalCount = year === 'last' ? data.total.lastYear : data.total[year]\n\n    return (\n      <Calendar\n        data={transformData(data.contributions, transformFn)}\n        labels={Object.assign({}, defaultLabels, labels)}\n        ref={ref}\n        totalCount={transformFn && transformTotalCount ? undefined : totalCount}\n        {...props}\n        theme={theme}\n        loading={Boolean(props.loading) || loading}\n        maxLevel={4}\n      />\n    )\n  },\n)\n\nGitHubCalendar.displayName = 'GitHubCalendar'\n\nconst gitHubTheme = {\n  light: ['#ebedf0', '#9be9a8', '#40c463', '#30a14e', '#216e39'],\n  dark: ['#161b22', '#0e4429', '#006d32', '#26a641', '#39d353'],\n} satisfies ThemeInput\n\nexport default GitHubCalendar\n"],"names":["transformData","data","transformFn","transformedData","Array","isArray","Error","d","isRecord","count","date","test","level","o","Object","prototype","toString","call","fetchCalendarData","username","year","apiUrl","response","fetch","String","json","ok","error","GitHubCalendar","forwardRef","labels","transformTotalCount","throwOnError","errorMessage","props","ref","setData","useState","loading","setLoading","setError","fetchData","useCallback","then","catch","err","finally","useEffect","_jsx","children","Skeleton","theme","gitHubTheme","defaultLabels","totalCount","total","lastYear","Calendar","contributions","assign","undefined","Boolean","maxLevel","displayName","light","dark"],"mappings":"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"}